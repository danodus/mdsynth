#-----------------------------------------------------------------
# File:    Makefile
# Author:  David Burnette
# Date:    April 7, 2008
#
# Description:
#  This makefile generates a VHDL file from assembler source.
#  A translate rule in mktargets.mk handles compiling the .asm
#  into a S19 record file (.S19) and then running s19tovhd to
#  generate a VHDL file with SPARTAN3 block rams with INIT generics
#  containing the binary data.
#
#  This particular makefile handles generating SYS09BUG code.
#
# Usage:
#  This make file is called recursively by the board-specific
#  makefiles in the 'rtl' directory. The targets generated by
#  this makefile are:
#
#    make                     - makes all variants
#    make all                 - makes all variants
#    make sys09swt.vhd        - For SWTPc compatible computers
#    make sys09ads.vhd        - For Ackerman Digital 6809 S100 board
#    make sys09b3s.vhd        - For B3-SPARTAN2 with 16 bit IDE interface 
#    make sys09b5x.vhd        - For B5-X300 with CF card with 8 bit inte
#    make sys09s3s.vhd        - For Digilent Spartan 3 starter board with RAM disk
#    make sys09s3e.vhd        - For Digilent Spartan 3E starter board
#    make sys09xes.vhd        - For XSA-3S100/XST-3.0 with 16 Bit IDE interface
#
# Target Descriptions:
#  The first file listed is the source file passed to assembler.
#  Remaining files are the dependencies. The option variables
#  ADDRS, ENTITY and TOP_RAM are used by the s19tovhd utility
#  to generate the VHDL file.
#
# Dependencies:
#  This makefile depends on def_rules.mk and the top-level
#  ram model file mon_rom_vhd.
#
# Revision History:
#   dgb 2008-04-07   Original version
#   jek 2008-09-07   Added B3-SPARTAN2
#
#-----------------------------------------------------------------

ifeq "$(MKFRAGS)" ""
MKFRAGS := ..\..\mkfiles
endif

include $(MKFRAGS)\def_rules.mk

all: sys09s3a.vhd

sys09s3a.vhd: sys09s3a.asm opt_s3a.asm sys09equ.asm sys09bug.asm
sys09s3a.vhd: BRAM_TYPE=b16
sys09s3a.vhd: ADDRS=F000 F800
sys09s3a.vhd: ENTITY=SYS09BUG
sys09s3a.vhd: TOP_RAM=mon_rom_vhd


.PHONY: clean
clean:
	-$(RM) *.S19
	-$(RM) *.lst
	-$(RM) *.vhd
