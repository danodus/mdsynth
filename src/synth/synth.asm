*
*    Adaptation of the micro-C driver under FLEX
*
*	   12-Dec-81  M.Ohta,H.Tezuka
*

	ORG	$100

_00001	PSHS	D,X,Y		multiply
	
	LDA	,S
	LDB	3,S
	MUL
	STB	4,S
	
	LDD	1,S
	MUL
	STB	5,S
	
	LDA	1,S
	LDB	3,S
	MUL
	ADDA	4,S
	ADDA	5,S
	
	LEAS	6,S
	RTS
*
_00002	CLR	,-S		signed divide
	
	CMPX	#0
	BPL	_02000
	
	COM	,S
	
	EXG	D,X
	LBSR	_00020
	EXG	D,X

_02000	TSTA
	BPL	_02001
	
	COM	,S
	
	LBSR	_00020
	
_02001	LBSR	_00010
	TFR	X,D
	TST	,S+
	BPL	_02002
	
	LBSR	_00020
	
_02002	RTS
*
_00003	LBSR	_00010		unsigned divide
	TFR	X,D
	RTS
*
_00004	CLR	,-S		signed modulous
	
	CMPX	#0
	BPL	_04000
	
	EXG	D,X
	BSR	_00020
	EXG	D,X

_04000	TSTA
	BPL	_04001
	
	COM	,S
	BSR	_00020
	
_04001	BSR	_00010
	
	TST	,S+
	BPL	_04002
	
	BSR	_00020
	
_04002	RTS
*
_00005	BSR	_00010		unsigned modulous

	RTS
*
_00006	CMPX	#0		signed left shift
	BMI	_06001
 
_06000	BEQ	_06009
	LSLB
	ROLA
	LEAX	-1,X
	BRA	_06000
	
_06001	BEQ	_06009
	ASRA
	RORB
	LEAX	1,X
	BRA	_06001
	
_06009	RTS
*
_00007	CMPX	#0		unsined left shift
	BMI	_07001
	
_07000	BEQ	_07009
	LSLB
	ROLA
	LEAX	-1,X
	BRA	_07000
	
_07001	BEQ	_07009
	LSRA
	RORB
	LEAX	1,X
	BRA	_07001
	
_07009	RTS
*
_00008	CMPX	#0		sined right shift
	BMI	_08001
	
_08000	BEQ	_08009
	ASRA
	RORB
	LEAX	-1,X
	BRA	_08000
	
_08001	BEQ	_08009
	LSLB
	ROLA
	LEAX	1,X
	BRA	_08001
	
_08009	RTS
*
_00009	CMPX	#0		unsined right shift
	BMI	_09001
	
_09000	BEQ	_09009
	LSRA
	RORB
	LEAX	-1,X
	BRA	_09000
	
_09001	BEQ	_09009
	LSLB
	ROLA
	LEAX	1,X
	BRA	_09001
	
_09009	RTS
*
_00020	NEGA			negate D reg
	NEGB
	SBCA	#0
	RTS
*
_00010	PSHS	D,X		divide subroutine
	
	CLRA
	CLRB
	
	LDX	#17
	
_00011	SUBD	2,S
	BCC	_00012
	
	ADDD	2,S
	
_00012	ROL	1,S
	ROL	,S
	ROLB
	ROLA
	
	LEAX	-1,X
	BNE	_00011
	
	RORA
	RORB
	
	COM	1,S
	COM	,S
	PULS	X
	
	LEAS	2,S
	RTS

	ORG	$0F00
STACK	EQU	*
		
	ORG	$1000
	LDS	#STACK
	JSR	_INITIALIZE
	JSR	main
	BRA	*
curx	EQU	0
cury	EQU	1
printc
	PSHS	U
	LEAU	,S
	LDD	#57395
	TFR	D,X
	LDB	1,Y
	SEX
	STB	0,X
	LDD	#57394
	TFR	D,X
	LDB	0,Y
	SEX
	STB	0,X
	LDD	#57392
	TFR	D,X
	LDB	5,U
	SEX
	STB	0,X
	LEAX	0,Y
	LDB	,X
	INC	,X
	SEX
	LDD	#57394
	TFR	D,X
	LDB	0,Y
	SEX
	STB	0,X
	PULS	U,PC
prints
	PSHS	U
	LEAU	,S
	LDD	#57395
	TFR	D,X
	LDB	1,Y
	SEX
	STB	0,X
_3
	LDB	[4,U]
	SEX
	LBEQ	_2
	LDD	#57394
	TFR	D,X
	LDB	0,Y
	SEX
	STB	0,X
	LDB	[4,U]
	SEX
	PSHS	D
	LDD	#57392
	TFR	D,X
	PULS	D
	STB	0,X
	LEAX	0,Y
	LDB	,X
	INC	,X
	SEX
	LDD	4,U
	ADDD	#1
	STD	4,U
	SUBD	#1
	LBRA	_3
_2
	LDD	#57394
	TFR	D,X
	LDB	0,Y
	SEX
	STB	0,X
	PULS	U,PC
moveto
	PSHS	U
	LEAU	,S
	LDB	5,U
	SEX
	STB	0,Y
	LDB	7,U
	SEX
	STB	1,Y
	LDD	#57394
	TFR	D,X
	LDB	0,Y
	SEX
	STB	0,X
	LDD	#57395
	TFR	D,X
	LDB	1,Y
	SEX
	STB	0,X
	PULS	U,PC
clearscr
	PSHS	U
	LEAU	,S
	LEAS	-2,S
	CLRA
	CLRB
	STB	-2,U
_5
	LDB	-2,U
	SEX
	SUBD	#25
	LBGE	_4
	LDD	#57395
	TFR	D,X
	LDB	-2,U
	SEX
	STB	0,X
	CLRA
	CLRB
	STB	-1,U
_8
	LDB	-1,U
	SEX
	SUBD	#80
	LBGE	_7
	LDD	#57394
	TFR	D,X
	LDB	-1,U
	SEX
	STB	0,X
	LDD	#57392
	TFR	D,X
	LDD	#32
	STB	0,X
_9
	LEAX	-1,U
	LDB	,X
	INC	,X
	SEX
	LBRA	_8
_7
_6
	LEAX	-2,U
	LDB	,X
	INC	,X
	SEX
	LBRA	_5
_4
	PULS	D,U,PC
printh4
	PSHS	U
	LEAU	,S
	LDD	4,U
	SUBD	#9
	LBLS	_10
	LDD	4,U
	SUBD	#10
	ADDD	#65
	PSHS	D
	LBSR	printc
	LEAS	2,S
	LBRA	_11
_10
	LDD	4,U
	ADDD	#48
	PSHS	D
	LBSR	printc
	LEAS	2,S
_11
	PULS	U,PC
printh8
	PSHS	U
	LEAU	,S
	LDD	#4
	PSHS	D
	LDD	4,U
	PULS	X
	LBSR	_00009
	PSHS	D
	LBSR	printh4
	LEAS	2,S
	LDD	4,U
	ANDA	#0
	ANDB	#15
	PSHS	D
	LBSR	printh4
	LEAS	2,S
	PULS	U,PC
getch
	PSHS	U
	LEAU	,S
_13
	LDD	#57376
	TFR	D,X
	LDB	0,X
	SEX
	ANDA	#0
	ANDB	#1
	SUBD	#0
	LBEQ	_13
_12
	LDD	#57377
	TFR	D,X
	LDB	0,X
	SEX
	PULS	U,PC
sndl	EQU	2
sndr	EQU	4
waveform	EQU	6
carrphd	EQU	8
phds	EQU	10
play
	PSHS	U
	LEAU	,S
	LEAS	-6,S
	LDD	4,U
	LBEQ	_14
	LDD	#12
	PSHS	D
	LDD	4,U
	PULS	X
	LBSR	_00003
	STD	-2,U
	LDD	#12
	PSHS	D
	LDD	4,U
	PULS	X
	LBSR	_00005
	STD	-4,U
	LDD	#12
	PSHS	D
	LDD	-2,U
	PULS	X
	LBSR	_00007
	STD	-6,U
	LDD	-4,U
	ASLB
	ROLA
	LEAX	10,Y
	LDD	D,X
	PSHS	D
	LDD	-6,U
	ORA	,S+
	ORB	,S+
	STD	-6,U
	LDD	#8
	PSHS	D
	LDD	-6,U
	PULS	X
	LBSR	_00009
	LDX	2,Y
	STB	1,X
	LDD	-6,U
	LDX	2,Y
	STB	2,X
	LDD	#8
	PSHS	D
	LDD	8,Y
	PULS	X
	LBSR	_00009
	LDX	2,Y
	STB	3,X
	LDD	8,Y
	LDX	2,Y
	STB	4,X
	LDD	6,Y
	LDX	2,Y
	STB	0,X
	LDD	#8
	PSHS	D
	LDD	-6,U
	PULS	X
	LBSR	_00009
	LDX	4,Y
	STB	1,X
	LDD	-6,U
	LDX	4,Y
	STB	2,X
	LDD	#8
	PSHS	D
	LDD	8,Y
	PULS	X
	LBSR	_00009
	LDX	4,Y
	STB	3,X
	LDD	8,Y
	LDX	4,Y
	STB	4,X
	LDD	6,Y
	LDX	4,Y
	STB	0,X
	LBRA	_15
_14
	CLRA
	CLRB
	LDX	2,Y
	STB	0,X
	CLRA
	CLRB
	LDX	4,Y
	STB	0,X
_15
	LEAS	,U
	PULS	U,PC
main
	PSHS	U
	LEAU	,S
	LEAS	-6,S
	LDD	#57472
	STD	2,Y
	LDD	#57488
	STD	4,Y
	LDD	#702
	STD	10,Y
	LDD	#744
	STD	12,Y
	LDD	#788
	STD	14,Y
	LDD	#835
	STD	16,Y
	LDD	#885
	STD	18,Y
	LDD	#937
	STD	20,Y
	LDD	#993
	STD	22,Y
	LDD	#1052
	STD	24,Y
	LDD	#1115
	STD	26,Y
	LDD	#1181
	STD	28,Y
	LDD	#1251
	STD	30,Y
	LDD	#1326
	STD	32,Y
	LDD	#1024
	STD	8,Y
	LDD	#1
	STD	6,Y
	LBSR	clearscr
	CLRA
	CLRB
	PSHS	D
	CLRA
	CLRB
	PSHS	D
	LBSR	moveto
	LEAS	4,S
	LEAX	2,PC
	BRA	_16
	FCB	77,68,83,121,110,116,104,0
_16
	PSHS	X
	LBSR	prints
	LEAS	2,S
	LDD	#1
	PSHS	D
	CLRA
	CLRB
	PSHS	D
	LBSR	moveto
	LEAS	4,S
	LEAX	2,PC
	BRA	_17
	FCB	67,111,112,121,114,105,103,104
	FCB	116,32,40,99,41,32,50,48
	FCB	49,49,44,32,77,101,108,100
	FCB	111,114,97,32,73,110,99,46
	FCB	0
_17
	PSHS	X
	LBSR	prints
	LEAS	2,S
	LDD	#3
	PSHS	D
	LDD	#10
	PSHS	D
	LBSR	moveto
	LEAS	4,S
	LEAX	2,PC
	BRA	_18
	FCB	32,87,32,69,32,82,32,32
	FCB	32,89,32,85,0
_18
	PSHS	X
	LBSR	prints
	LEAS	2,S
	LDD	#4
	PSHS	D
	LDD	#10
	PSHS	D
	LBSR	moveto
	LEAS	4,S
	LEAX	2,PC
	BRA	_19
	FCB	65,32,83,32,68,32,70,32
	FCB	71,32,72,32,74,0
_19
	PSHS	X
	LBSR	prints
	LEAS	2,S
	LDD	#5
	PSHS	D
	LDD	#10
	PSHS	D
	LBSR	moveto
	LEAS	4,S
	LEAX	2,PC
	BRA	_20
	FCB	90,44,32,88,58,32,79,99
	FCB	116,97,118,101,32,43,47,45
	FCB	32,32,32,49,44,32,50,44
	FCB	32,51,44,32,52,58,32,83
	FCB	113,117,97,114,101,47,84,114
	FCB	105,47,83,105,110,101,47,80
	FCB	104,77,111,100,0
_20
	PSHS	X
	LBSR	prints
	LEAS	2,S
	LDD	#6
	PSHS	D
	LDD	#10
	PSHS	D
	LBSR	moveto
	LEAS	4,S
	LEAX	2,PC
	BRA	_21
	FCB	67,44,32,86,58,32,80,104
	FCB	77,111,100,32,67,97,114,114
	FCB	105,101,114,32,80,104,68,32
	FCB	43,47,45,32,32,32,32,32
	FCB	65,110,121,32,111,116,104,101
	FCB	114,32,107,101,121,58,32,81
	FCB	117,105,101,116,0
_21
	PSHS	X
	LBSR	prints
	LEAS	2,S
	LDD	#9
	PSHS	D
	CLRA
	CLRB
	PSHS	D
	LBSR	moveto
	LEAS	4,S
	LEAX	2,PC
	BRA	_22
	FCB	79,99,116,97,118,101,58,0
_22
	PSHS	X
	LBSR	prints
	LEAS	2,S
	LDD	#10
	PSHS	D
	CLRA
	CLRB
	PSHS	D
	LBSR	moveto
	LEAS	4,S
	LEAX	2,PC
	BRA	_23
	FCB	67,97,114,114,80,104,68,58
	FCB	0
_23
	PSHS	X
	LBSR	prints
	LEAS	2,S
	LDD	#11
	PSHS	D
	CLRA
	CLRB
	PSHS	D
	LBSR	moveto
	LEAS	4,S
	LEAX	2,PC
	BRA	_24
	FCB	80,105,116,99,104,58,0
_24
	PSHS	X
	LBSR	prints
	LEAS	2,S
	LDD	#5
	STB	-3,U
_26
	LBSR	getch
	STB	-1,U
	LDB	-1,U
	SEX
	CMPD	#65
	BEQ	_28
	CMPD	#97
	LBNE	_29
_28
	CLRA
	CLRB
	STB	-2,U
	LBRA	_27
_29
	CMPD	#87
	BEQ	_30
	CMPD	#119
	LBNE	_31
_30
	LDD	#1
	STB	-2,U
	LBRA	_27
_31
	CMPD	#83
	BEQ	_32
	CMPD	#115
	LBNE	_33
_32
	LDD	#2
	STB	-2,U
	LBRA	_27
_33
	CMPD	#101
	BEQ	_34
	CMPD	#69
	LBNE	_35
_34
	LDD	#3
	STB	-2,U
	LBRA	_27
_35
	CMPD	#68
	BEQ	_36
	CMPD	#100
	LBNE	_37
_36
	LDD	#4
	STB	-2,U
	LBRA	_27
_37
	CMPD	#82
	BEQ	_38
	CMPD	#114
	LBNE	_39
_38
	LDD	#5
	STB	-2,U
	LBRA	_27
_39
	CMPD	#70
	BEQ	_40
	CMPD	#102
	LBNE	_41
_40
	LDD	#6
	STB	-2,U
	LBRA	_27
_41
	CMPD	#71
	BEQ	_42
	CMPD	#103
	LBNE	_43
_42
	LDD	#7
	STB	-2,U
	LBRA	_27
_43
	CMPD	#89
	BEQ	_44
	CMPD	#121
	LBNE	_45
_44
	LDD	#8
	STB	-2,U
	LBRA	_27
_45
	CMPD	#72
	BEQ	_46
	CMPD	#104
	LBNE	_47
_46
	LDD	#9
	STB	-2,U
	LBRA	_27
_47
	CMPD	#85
	BEQ	_48
	CMPD	#117
	LBNE	_49
_48
	LDD	#10
	STB	-2,U
	LBRA	_27
_49
	CMPD	#74
	BEQ	_50
	CMPD	#106
	LBNE	_51
_50
	LDD	#11
	STB	-2,U
	LBRA	_27
_51
	CMPD	#90
	BEQ	_52
	CMPD	#122
	LBNE	_53
_52
	LDB	-3,U
	SEX
	SUBD	#0
	LBLE	_54
	LEAX	-3,U
	LDB	,X
	DEC	,X
	SEX
_54
	LBRA	_27
_53
	CMPD	#88
	BEQ	_55
	CMPD	#120
	LBNE	_56
_55
	LDB	-3,U
	SEX
	SUBD	#9
	LBGE	_57
	LEAX	-3,U
	LDB	,X
	INC	,X
	SEX
_57
	LBRA	_27
_56
	CMPD	#49
	LBNE	_59
_58
	LDD	#1
	STD	6,Y
	LBRA	_27
_59
	CMPD	#50
	LBNE	_61
_60
	LDD	#2
	STD	6,Y
	LBRA	_27
_61
	CMPD	#51
	LBNE	_63
_62
	LDD	#3
	STD	6,Y
	LBRA	_27
_63
	CMPD	#52
	LBNE	_65
_64
	LDD	#4
	STD	6,Y
	LBRA	_27
_65
	CMPD	#99
	LBNE	_67
_66
	LDD	8,Y
	SUBD	#8
	STD	8,Y
	LBRA	_27
_67
	CMPD	#67
	LBNE	_69
_68
	LDD	8,Y
	SUBD	#128
	STD	8,Y
	LBRA	_27
_69
	CMPD	#118
	LBNE	_71
_70
	LDD	8,Y
	ADDD	#8
	STD	8,Y
	LBRA	_27
_71
	CMPD	#86
	LBNE	_73
_72
	LDD	8,Y
	ADDD	#128
	STD	8,Y
	LBRA	_27
_74
	LDD	#-1
	STB	-2,U
_73	EQU	_74
_27
	LDD	#9
	PSHS	D
	LDD	#10
	PSHS	D
	LBSR	moveto
	LEAS	4,S
	LDB	-3,U
	SEX
	PSHS	D
	LBSR	printh8
	LEAS	2,S
	LDD	#10
	PSHS	D
	LDD	#10
	PSHS	D
	LBSR	moveto
	LEAS	4,S
	LDD	#8
	PSHS	D
	LDD	8,Y
	PULS	X
	LBSR	_00009
	PSHS	D
	LBSR	printh8
	LEAS	2,S
	LDD	8,Y
	ANDA	#0
	ANDB	#255
	PSHS	D
	LBSR	printh8
	LEAS	2,S
	LDB	-2,U
	SEX
	SUBD	#0
	LBLT	_75
	LDB	-2,U
	SEX
	PSHS	D
	LDD	#12
	PSHS	D
	LDB	-3,U
	SEX
	PULS	X
	LBSR	_00001
	ADDD	,S++
	STB	-4,U
	LDD	#11
	PSHS	D
	LDD	#10
	PSHS	D
	LBSR	moveto
	LEAS	4,S
	LDB	-4,U
	SEX
	PSHS	D
	LBSR	printh8
	LEAS	2,S
	LDB	-4,U
	SEX
	PSHS	D
	LBSR	play
	LEAS	2,S
	LBRA	_76
_75
	LDD	#11
	PSHS	D
	LDD	#10
	PSHS	D
	LBSR	moveto
	LEAS	4,S
	LEAX	2,PC
	BRA	_77
	FCB	45,45,0
_77
	PSHS	X
	LBSR	prints
	LEAS	2,S
	CLRA
	CLRB
	PSHS	D
	LBSR	play
	LEAS	2,S
_76
	LBRA	_26
_25
	CLRA
	CLRB
	LEAS	,U
	PULS	U,PC
_1	RTS
_INITIALIZE	EQU	_1
_GLOBALS	EQU	34
	END
